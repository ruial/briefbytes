<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <meta name="description" content="As a part of my job, I occasionally have to intercept HTTPS requests made from a mobile application. This is required to troubleshoot some issues and guarantee that the correct data is being sent. I w">
<meta property="og:type" content="article">
<meta property="og:title" content="Debugging mobile apps with an HTTPS proxy">
<meta property="og:url" content="https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/index.html">
<meta property="og:site_name" content="BRIEF BYTES">
<meta property="og:description" content="As a part of my job, I occasionally have to intercept HTTPS requests made from a mobile application. This is required to troubleshoot some issues and guarantee that the correct data is being sent. I w">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-05-27T22:00:00.000Z">
<meta property="article:modified_time" content="2021-06-13T23:08:09.347Z">
<meta property="article:author" content="Rui Almeida">
<meta property="article:tag" content="analytics">
<meta property="article:tag" content="android">
<meta property="article:tag" content="ios">
<meta name="twitter:card" content="summary">
    
    
        
          
              <link rel="shortcut icon" href="/images/desktop.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/android.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple.png">
          
        
    
    
    <title>Debugging mobile apps with an HTTPS proxy</title>
    
    
<link rel="stylesheet" href="/css/style.css">

    
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    
    
    
      <link rel="alternate" href="/atom.xml" title="BRIEF BYTES" type="application/atom+xml">
    
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")' style="display:none"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/ruial">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/Game-hacking-on-Linux/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li>
        
        
        <li><a class="icon" href="/2019/Hello-world/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li>
        
        <li><a class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none">Previous post</span>
      <span id="i-next" class="info" style="display:none">Next post</span>
      <span id="i-top" class="info" style="display:none">Back to top</span>
      <span id="i-share" class="info" style="display:none">Share post</span>
    </span>
    <br>
    <div id="share" style="display:none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/"><i class="fab fa-facebook" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&text=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-twitter" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&is_video=false&description=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-pinterest" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Debugging mobile apps with an HTTPS proxy&body=Check out this article: https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/"><i class="fas fa-envelope" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-get-pocket" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-reddit" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-stumbleupon" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-digg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&name=Debugging mobile apps with an HTTPS proxy&description="><i class="fab fa-tumblr" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&t=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-hacker-news" aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analytics"><span class="toc-number">1.</span> <span class="toc-text">Analytics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mitmproxy"><span class="toc-number">2.</span> <span class="toc-text">mitmproxy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Closing-thoughts"><span class="toc-number">3.</span> <span class="toc-text">Closing thoughts</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Debugging mobile apps with an HTTPS proxy
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">BRIEF BYTES</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-05-27T22:00:00.000Z" itemprop="datePublished">2019-05-27</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/analytics/" rel="tag">analytics</a>, <a class="tag-link-link" href="/tags/android/" rel="tag">android</a>, <a class="tag-link-link" href="/tags/ios/" rel="tag">ios</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>As a part of my job, I occasionally have to intercept HTTPS requests made from a mobile application. This is required to troubleshoot some issues and guarantee that the correct data is being sent. I will explain how I do it and talk about analytics while I briefly analyze a popular app.</p>
<h2 id="Analytics"><a href="#Analytics" class="headerlink" title="Analytics"></a>Analytics</h2><p>How much time users spend on the app? How many times do they return per month? Does performance have a significant impact on other metrics? Which button is clicked the most from our A/B test? These are questions that can be answered by analytics and help in making data-driven decisions which previously relied on intuition.</p>
<p>As storage and computing resources are getting cheaper, data collection and processing increases. Many apps track all the relevant events and aggregate this data for further analysis.</p>
<p>Let’s take a look at the Airbnb app. They are hitting 2 different tracking endpoints. Events are tracked regarding navigation, performance, searches, app lifecycle, and contain information about the device such as the model, screen size, network type, language, etc… On the app, these events are sent in batches to reduce bandwidth usage, which is not the case on their website as scrolling through the main page will trigger dozens of tracking requests, as we can check in the dev tools. An example of the tracked events of the app can be found in the image bellow.</p>


<p>We can observe an object with a key called “advertising-ID” with the value containing several zeros. One feature not known by many people and enabled by default in Android and iOS is the advertising ID. It is a random unique identifier that ad companies can use to track users, similar to a tracking cookie on the web. In the phone settings we can request a new advertising ID or even disable it completely, forcing apps to rely on other data to track users (IP address, device fingerprinting, generated identifiers).</p>
<p>To disable the advertising ID follow these steps:</p>
<ul>
<li>Android<ul>
<li><em>Settings &gt; Google &gt; Ads &gt; Opt out of Ads Personalization</em></li>
</ul>
</li>
<li>iOS<ul>
<li><em>Settings &gt; Privacy &gt; Advertising &gt; Limit Ad tracking</em></li>
</ul>
</li>
</ul>
<h2 id="mitmproxy"><a href="#mitmproxy" class="headerlink" title="mitmproxy"></a>mitmproxy</h2><p>One useful open-source HTTPS proxy is <a target="_blank" rel="noopener" href="https://mitmproxy.org/">mitmproxy</a>. It allows to intercept and modify requests through the terminal or web interface. Another popular free alternative with a focus on web security is <a target="_blank" rel="noopener" href="https://portswigger.net/burp">Burp Suite</a>. This way we can reverse engineer the APIs used by apps.</p>
<p>The quickest way to start mitmproxy is with Docker:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -it -v ~/.mitmproxy:/home/mitmproxy/.mitmproxy -p 8080:8080 -p 127.0.0.1:8081:8081 mitmproxy/mitmproxy mitmweb --web-iface 0.0.0.0</span><br></pre></td></tr></table></figure>

<p>Now we can access the UI at <em>localhost:8081</em>. To set the proxy on both iOS and Android devices, go to “<em>Settings &gt; Wi-Fi</em>“, tap the connected network and enter the computer’s IP address as the server/hostname and <em>8080</em> as the port. In case the connection is failing, the computer’s firewall may be the issue.</p>
<p>If the root certificate was not previously installed, visit <em>mitm.it</em> on your browser and click the image of your operating system to install the certificates. For Android, a dialog will appear to choose a certificate name and select “VPN and apps” as the “Credential use”. For iOS go to “<em>Settings &gt; General &gt; Profiles</em>“, tap on the created profile to install the certificate and then enable it in “<em>Settings &gt; General &gt; About &gt; Certificate Trust Settings</em>“.</p>
<p>Nowadays most popular apps employ a security technique called <a target="_blank" rel="noopener" href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning">Certificate Pinning</a>. If the certificate is not trusted by the app, connections are dropped. To perform man in the middle attacks we now have to tamper with the app to disable certificate pinning using toolkits like <a target="_blank" rel="noopener" href="https://github.com/sensepost/objection">objection</a> and <a target="_blank" rel="noopener" href="https://www.frida.re/">Frida</a>.</p>
<h2 id="Closing-thoughts"><a href="#Closing-thoughts" class="headerlink" title="Closing thoughts"></a>Closing thoughts</h2><p>mitmproxy is a very useful tool. Addons like this one can be coded in Python:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> http, ctx</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="comment"># simulate failure in 25% of tracking requests</span></span><br><span class="line"><span class="comment"># Usage (has live reload): mitmweb -s intercept.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request</span>(<span class="params">flow: http.HTTPFlow</span>):</span></span><br><span class="line">  url = flow.request.url</span><br><span class="line">  <span class="keyword">if</span> <span class="string">&#x27;tracking&#x27;</span> <span class="keyword">in</span> url <span class="keyword">and</span> randint(<span class="number">1</span>, <span class="number">100</span>) &lt; <span class="number">25</span>:</span><br><span class="line">    ctx.log.warn(<span class="string">&#x27;Fail &#x27;</span> + url)</span><br><span class="line">    flow.response = http.HTTPResponse.make(<span class="number">500</span>, <span class="string">&#x27;&#x27;</span>, &#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>I think that analytics is very important to figure out how users are interacting with the software. The data collected can be analyzed to provide a better service by identifying issues and trends, however care should be taken to respect user’s privacy and comply with <em>GDPR</em>.</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display:none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/ruial">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display:none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Analytics"><span class="toc-number">1.</span> <span class="toc-text">Analytics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mitmproxy"><span class="toc-number">2.</span> <span class="toc-text">mitmproxy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Closing-thoughts"><span class="toc-number">3.</span> <span class="toc-text">Closing thoughts</span></a></li></ol>
    </div>

    <div id="share-footer" style="display:none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&text=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&is_video=false&description=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Debugging mobile apps with an HTTPS proxy&body=Check out this article: https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&title=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&name=Debugging mobile apps with an HTTPS proxy&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://briefbytes.com/2019/Debugging-mobile-apps-with-an-https-proxy/&t=Debugging mobile apps with an HTTPS proxy"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick='return $("#nav-footer").toggle(),!1'><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick='return $("#toc-footer").toggle(),!1'><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick='return $("#share-footer").toggle(),!1'><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick='$("html, body").animate({scrollTop:0},"fast")'><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021
    Rui Almeida
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/ruial">Projects</a></li>
         
          <li><a href="/search/">Search</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>



  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">$(function(){$(".highlight table").before('<span class="btn-copy tooltipped tooltipped-sw" aria-label="Copy to clipboard!"><i class="far fa-clone"></i></span>'),new ClipboardJS(".btn-copy",{text:function(e){return Array.from(e.nextElementSibling.querySelectorAll(".code")).reduce((e,t)=>e+t.innerText+"\n","")}}).on("success",function(e){e.trigger.setAttribute("aria-label","Copied!"),e.clearSelection()})})</script>


<script src="/js/main.js"></script>





    <script type="text/javascript">!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-141298250-1","auto"),ga("send","pageview")</script>






</body>
</html>
